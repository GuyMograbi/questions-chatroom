"use strict";
var __cov_XCptq6xov88QOz_iGHJ9ug = (Function('return this'))();
if (!__cov_XCptq6xov88QOz_iGHJ9ug.__coverage__) { __cov_XCptq6xov88QOz_iGHJ9ug.__coverage__ = {}; }
__cov_XCptq6xov88QOz_iGHJ9ug = __cov_XCptq6xov88QOz_iGHJ9ug.__coverage__;
if (!(__cov_XCptq6xov88QOz_iGHJ9ug['/home/home/dev_env/projects_GIT/guy-mograbi/questions-chatroom/backend/services/ChatService.js'])) {
   __cov_XCptq6xov88QOz_iGHJ9ug['/home/home/dev_env/projects_GIT/guy-mograbi/questions-chatroom/backend/services/ChatService.js'] = {"path":"/home/home/dev_env/projects_GIT/guy-mograbi/questions-chatroom/backend/services/ChatService.js","s":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0},"fnMap":{"1":{"name":"(anonymous_1)","line":19,"loc":{"start":{"line":19,"column":15},"end":{"line":19,"column":18}}},"2":{"name":"(anonymous_2)","line":29,"loc":{"start":{"line":29,"column":8},"end":{"line":29,"column":11}}},"3":{"name":"(anonymous_3)","line":33,"loc":{"start":{"line":33,"column":8},"end":{"line":33,"column":15}}},"4":{"name":"(anonymous_4)","line":50,"loc":{"start":{"line":50,"column":7},"end":{"line":50,"column":14}}},"5":{"name":"(anonymous_5)","line":81,"loc":{"start":{"line":81,"column":10},"end":{"line":81,"column":13}}},"6":{"name":"(anonymous_6)","line":87,"loc":{"start":{"line":87,"column":15},"end":{"line":87,"column":28}}},"7":{"name":"(anonymous_7)","line":99,"loc":{"start":{"line":99,"column":10},"end":{"line":99,"column":17}}}},"statementMap":{"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":37}},"2":{"start":{"line":4,"column":0},"end":{"line":4,"column":27}},"3":{"start":{"line":5,"column":0},"end":{"line":5,"column":29}},"4":{"start":{"line":6,"column":0},"end":{"line":6,"column":32}},"5":{"start":{"line":7,"column":0},"end":{"line":7,"column":26}},"6":{"start":{"line":8,"column":0},"end":{"line":8,"column":56}},"7":{"start":{"line":9,"column":0},"end":{"line":9,"column":31}},"8":{"start":{"line":11,"column":0},"end":{"line":11,"column":46}},"9":{"start":{"line":12,"column":0},"end":{"line":12,"column":43}},"10":{"start":{"line":13,"column":0},"end":{"line":13,"column":29}},"11":{"start":{"line":15,"column":0},"end":{"line":15,"column":28}},"12":{"start":{"line":20,"column":8},"end":{"line":20,"column":16}},"13":{"start":{"line":22,"column":8},"end":{"line":22,"column":25}},"14":{"start":{"line":23,"column":8},"end":{"line":26,"column":9}},"15":{"start":{"line":24,"column":12},"end":{"line":24,"column":45}},"16":{"start":{"line":30,"column":8},"end":{"line":30,"column":49}},"17":{"start":{"line":34,"column":8},"end":{"line":38,"column":17}},"18":{"start":{"line":40,"column":8},"end":{"line":40,"column":31}},"19":{"start":{"line":41,"column":8},"end":{"line":41,"column":20}},"20":{"start":{"line":51,"column":8},"end":{"line":51,"column":41}},"21":{"start":{"line":52,"column":8},"end":{"line":52,"column":31}},"22":{"start":{"line":53,"column":8},"end":{"line":53,"column":31}},"23":{"start":{"line":54,"column":8},"end":{"line":54,"column":20}},"24":{"start":{"line":55,"column":8},"end":{"line":78,"column":9}},"25":{"start":{"line":56,"column":12},"end":{"line":56,"column":35}},"26":{"start":{"line":57,"column":12},"end":{"line":57,"column":39}},"27":{"start":{"line":58,"column":12},"end":{"line":66,"column":15}},"28":{"start":{"line":59,"column":16},"end":{"line":65,"column":17}},"29":{"start":{"line":60,"column":20},"end":{"line":60,"column":121}},"30":{"start":{"line":61,"column":20},"end":{"line":64,"column":21}},"31":{"start":{"line":62,"column":24},"end":{"line":62,"column":52}},"32":{"start":{"line":63,"column":24},"end":{"line":63,"column":44}},"33":{"start":{"line":67,"column":12},"end":{"line":75,"column":13}},"34":{"start":{"line":68,"column":16},"end":{"line":74,"column":19}},"35":{"start":{"line":82,"column":8},"end":{"line":82,"column":35}},"36":{"start":{"line":83,"column":8},"end":{"line":83,"column":33}},"37":{"start":{"line":84,"column":8},"end":{"line":84,"column":25}},"38":{"start":{"line":88,"column":8},"end":{"line":88,"column":53}},"39":{"start":{"line":100,"column":8},"end":{"line":100,"column":50}},"40":{"start":{"line":101,"column":8},"end":{"line":101,"column":53}},"41":{"start":{"line":102,"column":8},"end":{"line":102,"column":36}},"42":{"start":{"line":103,"column":8},"end":{"line":103,"column":31}},"43":{"start":{"line":104,"column":8},"end":{"line":104,"column":20}},"44":{"start":{"line":109,"column":0},"end":{"line":109,"column":30}}},"branchMap":{"1":{"line":59,"type":"if","locations":[{"start":{"line":59,"column":16},"end":{"line":59,"column":16}},{"start":{"line":59,"column":16},"end":{"line":59,"column":16}}]},"2":{"line":61,"type":"if","locations":[{"start":{"line":61,"column":20},"end":{"line":61,"column":20}},{"start":{"line":61,"column":20},"end":{"line":61,"column":20}}]},"3":{"line":61,"type":"binary-expr","locations":[{"start":{"line":61,"column":24},"end":{"line":61,"column":53}},{"start":{"line":61,"column":57},"end":{"line":61,"column":84}}]},"4":{"line":67,"type":"if","locations":[{"start":{"line":67,"column":12},"end":{"line":67,"column":12}},{"start":{"line":67,"column":12},"end":{"line":67,"column":12}}]}}};
}
__cov_XCptq6xov88QOz_iGHJ9ug = __cov_XCptq6xov88QOz_iGHJ9ug['/home/home/dev_env/projects_GIT/guy-mograbi/questions-chatroom/backend/services/ChatService.js'];
__cov_XCptq6xov88QOz_iGHJ9ug.s['1']++;var EventEmitter=require('events');__cov_XCptq6xov88QOz_iGHJ9ug.s['2']++;var path=require('path');__cov_XCptq6xov88QOz_iGHJ9ug.s['3']++;var fs=require('fs-extra');__cov_XCptq6xov88QOz_iGHJ9ug.s['4']++;var uuid=require('node-uuid');__cov_XCptq6xov88QOz_iGHJ9ug.s['5']++;var _=require('lodash');__cov_XCptq6xov88QOz_iGHJ9ug.s['6']++;var logger=require('log4js').getLogger('ChatService');__cov_XCptq6xov88QOz_iGHJ9ug.s['7']++;var cosine=require('cosine');__cov_XCptq6xov88QOz_iGHJ9ug.s['8']++;var FILE_PATH=path.resolve('./dev/db.json');__cov_XCptq6xov88QOz_iGHJ9ug.s['9']++;logger.info('db to be kept at',FILE_PATH);__cov_XCptq6xov88QOz_iGHJ9ug.s['10']++;fs.ensureFileSync(FILE_PATH);__cov_XCptq6xov88QOz_iGHJ9ug.s['11']++;var SIMILARITY_LEVEL=0.75;class ChatDb extends EventEmitter{constructor(){__cov_XCptq6xov88QOz_iGHJ9ug.f['1']++;__cov_XCptq6xov88QOz_iGHJ9ug.s['12']++;super();__cov_XCptq6xov88QOz_iGHJ9ug.s['13']++;this.memory=[];__cov_XCptq6xov88QOz_iGHJ9ug.s['14']++;try{__cov_XCptq6xov88QOz_iGHJ9ug.s['15']++;this.memory=require(FILE_PATH);}catch(e){}}save(){__cov_XCptq6xov88QOz_iGHJ9ug.f['2']++;__cov_XCptq6xov88QOz_iGHJ9ug.s['16']++;fs.writeJsonSync(FILE_PATH,this.memory);}keep(data){__cov_XCptq6xov88QOz_iGHJ9ug.f['3']++;__cov_XCptq6xov88QOz_iGHJ9ug.s['17']++;var item=_.merge({id:uuid.v4(),answers:[],timestamp:new Date().getTime()},data);__cov_XCptq6xov88QOz_iGHJ9ug.s['18']++;this.memory.push(item);__cov_XCptq6xov88QOz_iGHJ9ug.s['19']++;return item;}ask(data){__cov_XCptq6xov88QOz_iGHJ9ug.f['4']++;__cov_XCptq6xov88QOz_iGHJ9ug.s['20']++;logger.info('service got',data);__cov_XCptq6xov88QOz_iGHJ9ug.s['21']++;data=this.keep(data);__cov_XCptq6xov88QOz_iGHJ9ug.s['22']++;this.emit('msg',data);__cov_XCptq6xov88QOz_iGHJ9ug.s['23']++;this.save();__cov_XCptq6xov88QOz_iGHJ9ug.s['24']++;try{__cov_XCptq6xov88QOz_iGHJ9ug.s['25']++;var bestSimilarity=0;__cov_XCptq6xov88QOz_iGHJ9ug.s['26']++;var similarQuestion=null;__cov_XCptq6xov88QOz_iGHJ9ug.s['27']++;_.each(this.memory,q=>{__cov_XCptq6xov88QOz_iGHJ9ug.s['28']++;if(_.size(q.answers)>0){__cov_XCptq6xov88QOz_iGHJ9ug.b['1'][0]++;__cov_XCptq6xov88QOz_iGHJ9ug.s['29']++;var similarity=cosine(q.content.toLowerCase().split(/\s/),data.content.toLowerCase().split(/\s/));__cov_XCptq6xov88QOz_iGHJ9ug.s['30']++;if((__cov_XCptq6xov88QOz_iGHJ9ug.b['3'][0]++,similarity>SIMILARITY_LEVEL)&&(__cov_XCptq6xov88QOz_iGHJ9ug.b['3'][1]++,similarity>bestSimilarity)){__cov_XCptq6xov88QOz_iGHJ9ug.b['2'][0]++;__cov_XCptq6xov88QOz_iGHJ9ug.s['31']++;bestSimilarity=similarity;__cov_XCptq6xov88QOz_iGHJ9ug.s['32']++;similarQuestion=q;}else{__cov_XCptq6xov88QOz_iGHJ9ug.b['2'][1]++;}}else{__cov_XCptq6xov88QOz_iGHJ9ug.b['1'][1]++;}});__cov_XCptq6xov88QOz_iGHJ9ug.s['33']++;if(similarQuestion){__cov_XCptq6xov88QOz_iGHJ9ug.b['4'][0]++;__cov_XCptq6xov88QOz_iGHJ9ug.s['34']++;this.answer({questionId:data.id,answer:{content:_.first(similarQuestion.answers).content,username:'bot'}});}else{__cov_XCptq6xov88QOz_iGHJ9ug.b['4'][1]++;}}catch(e){}}remove(){__cov_XCptq6xov88QOz_iGHJ9ug.f['5']++;__cov_XCptq6xov88QOz_iGHJ9ug.s['35']++;logger.info('removing db');__cov_XCptq6xov88QOz_iGHJ9ug.s['36']++;fs.removeSync(FILE_PATH);__cov_XCptq6xov88QOz_iGHJ9ug.s['37']++;this.memory=[];}getQuestion(questionId){__cov_XCptq6xov88QOz_iGHJ9ug.f['6']++;__cov_XCptq6xov88QOz_iGHJ9ug.s['38']++;return _.find(this.memory,{id:questionId});}answer(data){__cov_XCptq6xov88QOz_iGHJ9ug.f['7']++;__cov_XCptq6xov88QOz_iGHJ9ug.s['39']++;var q=this.getQuestion(data.questionId);__cov_XCptq6xov88QOz_iGHJ9ug.s['40']++;data.answer.timestamp=new Date().getTime();__cov_XCptq6xov88QOz_iGHJ9ug.s['41']++;q.answers.push(data.answer);__cov_XCptq6xov88QOz_iGHJ9ug.s['42']++;this.emit('msg',data);__cov_XCptq6xov88QOz_iGHJ9ug.s['43']++;this.save();}}__cov_XCptq6xov88QOz_iGHJ9ug.s['44']++;module.exports=new ChatDb();
